<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Service Health Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .status-online { background-color: #10B981; }
        .status-degraded { background-color: #F59E0B; }
        .status-offline { background-color: #EF4444; }
        .status-checking { background-color: #6B7280; }
        .refresh-animation { animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4">
    <div class="max-w-7xl mx-auto">
        <header class="mb-8">
            <h1 class="text-2xl font-bold text-gray-900 mb-2">Service Health Dashboard</h1>
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <p class="text-gray-600">Last checked: <span id="lastChecked">Just now</span></p>
                <button id="refreshBtn" class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                    <svg id="refreshIcon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    <span>Refresh</span>
                </button>
            </div>
        </header>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="servicesContainer">
            <!-- Services will be populated by JavaScript -->
        </div>
    </div>

    <script>
        const services = [
            { name: 'Penpot', url: 'http://penpot.localhost', icon: '🎨', description: 'Design & Prototyping' },
            { name: 'OpenWebUI', url: 'http://openwebui.localhost', icon: '🤖', description: 'AI Models' },
            { name: 'n8n', url: 'http://n8n.localhost', icon: '🔌', description: 'Workflow Automation' },
            { name: 'Gitea', url: 'http://gitea.localhost', icon: '🐙', description: 'Git Service' },
            { name: 'Codium', url: 'http://codium.localhost', icon: '💻', description: 'VS Code' },
            { name: 'Supabase', url: 'http://supabase.localhost', icon: '🛢️', description: 'Firebase Alt' },
            { name: 'Nextcloud', url: 'http://nextcloud.localhost', icon: '☁️', description: 'File Sharing' },
            { name: 'Redis Commander', url: 'http://redis-commander.localhost', icon: '🔑', description: 'Redis Commander Web UI' },
            { name: 'Mongo Express', url: 'http://mongo.localhost', icon: '🍃', description: 'Mongo Express Web UI' },
            { name: 'PgAdmin', url: 'http://pgadmin.localhost', icon: '🐘', description: 'PostgreSQL' },
            { name: 'MinIO', url: 'http://minio.localhost', icon: '📦', description: 'S3 Storage' },
            { name: 'Weaviate', url: 'http://weaviate.localhost', icon: '🧠', description: 'Vector DB' },
            { name: 'Elastic', url: 'http://elasticsearch.localhost', icon: '🔍', description: 'Search' },
            { name: 'Neo4j', url: 'http://neo4j.localhost', icon: '📊', description: 'Graph DB' }
        ];

        async function checkService(service) {
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 5000);
            
            try {
                const start = Date.now();
                await fetch(service.url, { method: 'HEAD', mode: 'no-cors', signal: controller.signal });
                return {
                    ...service,
                    status: 'online',
                    responseTime: Date.now() - start,
                    lastChecked: new Date().toLocaleTimeString(),
                    error: null
                };
            } catch (error) {
                return {
                    ...service,
                    status: error.name === 'AbortError' ? 'degraded' : 'offline',
                    responseTime: null,
                    lastChecked: new Date().toLocaleTimeString(),
                    error: error.name === 'AbortError' ? 'Timeout' : 'Unavailable'
                };
            } finally {
                clearTimeout(timeoutId);
            }
        }

        function updateServiceCard(service) {
            const card = document.getElementById(`service-${service.name}`) || document.createElement('div');
            card.id = `service-${service.name}`;
            card.className = 'bg-white rounded-lg shadow p-4 hover:shadow-md transition-shadow';
            
            const statusClass = {
                'online': 'status-online',
                'offline': 'status-offline',
                'degraded': 'status-degraded',
                'checking': 'status-checking'
            }[service.status] || 'bg-gray-200';

            card.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">${service.icon}</span>
                        <div>
                            <h3 class="font-medium text-gray-900">${service.name}</h3>
                            <p class="text-sm text-gray-500">${service.description}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        ${service.responseTime ? `<span class="text-xs text-gray-500">${service.responseTime}ms</span>` : ''}
                        <span class="w-3 h-3 rounded-full ${statusClass}" title="${service.status}"></span>
                    </div>
                </div>
                ${service.error ? `<div class="mt-2 text-xs text-red-600 bg-red-50 p-1 rounded text-center">${service.error}</div>` : ''}
                <div class="mt-2 text-xs text-gray-400 flex justify-between items-center">
                    <span>${service.lastChecked}</span>
                    <a href="${service.url}" target="_blank" class="text-blue-500 hover:underline text-sm">Open</a>
                </div>
            `;
            
            if (!card.parentNode) {
                document.getElementById('servicesContainer').appendChild(card);
            }
        }

        async function checkAllServices() {
            const refreshBtn = document.getElementById('refreshBtn');
            const refreshIcon = document.getElementById('refreshIcon');
            const lastCheckedEl = document.getElementById('lastChecked');
            
            refreshBtn.disabled = true;
            refreshIcon.classList.add('refresh-animation');
            
            // Show checking state
            services.forEach(svc => updateServiceCard({ ...svc, status: 'checking' }));
            
            // Check services in parallel but with small delay between each
            const results = [];
            for (const svc of services) {
                const result = await checkService(svc);
                results.push(result);
                updateServiceCard(result);
                await new Promise(resolve => setTimeout(resolve, 100)); // Small delay between checks
            }
            
            lastCheckedEl.textContent = new Date().toLocaleTimeString();
            refreshBtn.disabled = false;
            refreshIcon.classList.remove('refresh-animation');
        }

        // Initial load
        document.addEventListener('DOMContentLoaded', () => {
            checkAllServices();
            document.getElementById('refreshBtn').addEventListener('click', checkAllServices);
            
            // Auto-refresh every 600 seconds
            setInterval(checkAllServices, 600000);
        });
    </script>
</body>
</html>
